/**
 * Arlima template loader
 */var ArlimaTemplateLoader=function(e){"use strict";var t=function(e){return"/"==e.substr(e.length-1,1)&&(e=e.substr(0,e.length-1)),e.substr(0,e.lastIndexOf("/"))};return{isRequestingTemplate:!1,finishedLoading:!1,templates:{},_templateSupport:{},_templatesToLoad:[],_templateParts:{},load:function(e){this.finishedLoading=!1,this._templatesToLoad=e,this._loadNextTemplate()},templateSupport:function(e,t){return void 0===this._templateSupport[e]?void 0:this._templateSupport[e][t]},_loadNextTemplate:function(){var t=this;if(this.isRequestingTemplate)setTimeout(function(){t._loadNextTemplate()},200);else if(this._templatesToLoad.length>0){var a=this._templatesToLoad.splice(0,1)[0];3==a.length&&(a=a[1]),this._loadTemplate(a,function(s,i){t._templateParts[a]=s,e.each(t._parseIncludes(s,i),function(e,a){t._templatesToLoad.push(a)}),t._loadNextTemplate()})}else this._buildTemplates(),this.finishedLoading=!0},_parseIncludes:function(t,a){var s=t.match(/\{\{include [0-9a-z\/A-Z\-\_\.]*\}\}/g);if(s){var i=this;return e.each(s,function(e,t){var n=t.replace("{{include ","").replace("}}","");s[e]=[t,i._makeTemplateURL(a,n),a]}),s}return[]},_makeTemplateURL:function(t,a){var s=t+a;if(s.indexOf("../")>-1){var i=s.substr(s.indexOf("://")+3).split("/"),n=[];return e.each(i,function(e,t){".."==t?n.splice(-1):n.push(t)}),s.substr(0,s.indexOf("://"))+"://"+n.join("/")}return s},_buildTemplates:function(){var t=this;e.each(this._templateParts,function(e,a){var s=t.extractFileNameFromURL(e),i=e.substr(0,e.lastIndexOf("/"))+"/";t.templates[s]=a;for(var n=t._parseIncludes(t.templates[s],i);n&&n.length>0;){for(var r=0;r<n.length;r++)t.templates[s]=t.templates[s].replace(n[r][0],t._templateParts[n[r][1]]);n=t._parseIncludes(t.templates[s],i)}}),e.each(this.templates,function(a,s){var i=s.match(new RegExp("({{image-support .*}})","g"));if(i&&i[0]){t.templates[a]=s.replace(new RegExp("({{image-support .*}})","g"),"");var n=e.trim(i[0].substr(0,i[0].indexOf(" ")).replace("{{","")),r=e.trim(i[0].substr(i[0].indexOf(" ")).replace("}}",""));t._templateSupport[a]={},t._templateSupport[a][n]={},e.each(e("<div "+r+"></div>").get(0).attributes,function(e,s){r.indexOf(s.name)>-1&&(t._templateSupport[a][n][s.name]=s.value)})}}),delete this._templateParts},extractFileNameFromURL:function(e){var t=e.substr(e.lastIndexOf("/")+1,e.length);return t.substr(0,t.indexOf("."))},_loadTemplate:function(a,s){this.isRequestingTemplate=!0;var i=this;e.ajax({dataType:"text",url:a,success:function(e){i.isRequestingTemplate=!1,s(e,t(a)+"/")},error:function(){throw new Error("Unable to load template "+a)}})}}}(jQuery);